<!DOCTYPE html>
<html>
<head>
  <meta charset="UTF-8">
  <style>
    * {
      box-sizing: border-box;
      margin: 0;
      padding: 0;
    }

    body {
      font-family: 'Inter', -apple-system, BlinkMacSystemFont, sans-serif;
      font-size: 13px;
      padding: 20px;
      color: var(--figma-color-text);
      background: var(--figma-color-bg);
      line-height: 1.5;
    }

    .header {
      text-align: center;
      margin-bottom: 24px;
      padding-bottom: 16px;
      border-bottom: 2px solid var(--figma-color-border);
    }

    .header-title {
      font-size: 18px;
      font-weight: 700;
      margin-bottom: 4px;
      background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
      -webkit-background-clip: text;
      -webkit-text-fill-color: transparent;
      background-clip: text;
    }

    .header-subtitle {
      font-size: 11px;
      color: var(--figma-color-text-tertiary);
      font-weight: 500;
    }

    .version-badge {
      display: inline-block;
      background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
      color: white;
      padding: 4px 10px;
      border-radius: 12px;
      font-size: 10px;
      font-weight: 700;
      margin-top: 8px;
    }

    .section {
      margin-bottom: 24px;
      background: var(--figma-color-bg-secondary);
      padding: 16px;
      border-radius: 8px;
      border: 1px solid var(--figma-color-border);
    }

    .section-header {
      display: flex;
      align-items: center;
      margin-bottom: 16px;
      gap: 8px;
    }

    .section-icon {
      font-size: 16px;
    }

    .section-title {
      font-weight: 600;
      font-size: 13px;
      color: var(--figma-color-text);
      flex: 1;
    }

    .badge {
      background: var(--figma-color-bg-brand);
      color: white;
      padding: 2px 8px;
      border-radius: 12px;
      font-size: 9px;
      font-weight: 700;
      text-transform: uppercase;
      letter-spacing: 0.5px;
    }

    .badge.new {
      background: linear-gradient(135deg, #ff6b6b 0%, #ee5a6f 100%);
      animation: pulse 2s ease-in-out infinite;
    }

    @keyframes pulse {
      0%, 100% { opacity: 1; }
      50% { opacity: 0.8; }
    }

    label {
      display: block;
      font-size: 11px;
      font-weight: 600;
      margin-bottom: 6px;
      color: var(--figma-color-text);
      text-transform: uppercase;
      letter-spacing: 0.3px;
    }

    .input-group {
      position: relative;
      margin-bottom: 14px;
    }

    input[type="text"],
    input[type="password"],
    input[type="number"],
    textarea,
    select {
      width: 100%;
      padding: 10px 12px;
      border: 1.5px solid var(--figma-color-border);
      border-radius: 6px;
      font-size: 12px;
      font-family: inherit;
      background: var(--figma-color-bg);
      color: var(--figma-color-text);
      transition: all 0.2s ease;
    }

    input[type="text"]:focus,
    input[type="password"]:focus,
    input[type="number"]:focus,
    textarea:focus,
    select:focus {
      outline: none;
      border-color: var(--figma-color-bg-brand);
      box-shadow: 0 0 0 3px var(--figma-color-bg-brand-tertiary);
    }

    input[type="text"]::placeholder,
    input[type="password"]::placeholder {
      color: var(--figma-color-text-tertiary);
      opacity: 0.6;
    }

    select {
      cursor: pointer;
    }

    textarea {
      resize: vertical;
      min-height: 60px;
      font-family: 'SF Mono', Monaco, monospace;
      font-size: 11px;
    }

    .checkbox-group {
      display: flex;
      flex-direction: column;
      gap: 12px;
    }

    .export-type-cards {
      display: grid;
      grid-template-columns: repeat(3, 1fr);
      gap: 12px;
      margin-bottom: 16px;
    }

    .export-type-card {
      background: var(--figma-color-bg);
      border: 2px solid var(--figma-color-border);
      border-radius: 8px;
      padding: 14px;
      cursor: pointer;
      transition: all 0.2s ease;
      text-align: center;
    }

    .export-type-card:hover {
      border-color: var(--figma-color-bg-brand);
      transform: translateY(-2px);
    }

    .export-type-card.active {
      border-color: var(--figma-color-bg-brand);
      background: var(--figma-color-bg-brand-tertiary);
    }

    .export-type-icon {
      font-size: 32px;
      margin-bottom: 8px;
    }

    .export-type-name {
      font-size: 13px;
      font-weight: 600;
      color: var(--figma-color-text);
      margin-bottom: 4px;
    }

    .export-type-desc {
      font-size: 10px;
      color: var(--figma-color-text-tertiary);
    }

    .export-type-checkbox {
      width: 18px;
      height: 18px;
      margin-top: 8px;
      cursor: pointer;
      accent-color: var(--figma-color-bg-brand);
    }

    .platform-card {
      background: var(--figma-color-bg);
      border: 2px solid var(--figma-color-border);
      border-radius: 8px;
      padding: 12px;
      transition: all 0.2s ease;
      cursor: pointer;
    }

    .platform-card:hover {
      border-color: var(--figma-color-bg-brand);
      transform: translateY(-1px);
      box-shadow: 0 2px 8px rgba(0, 0, 0, 0.1);
    }

    .platform-card.active {
      border-color: var(--figma-color-bg-brand);
      background: var(--figma-color-bg-brand-tertiary);
    }

    .platform-header {
      display: flex;
      align-items: center;
      gap: 10px;
      margin-bottom: 10px;
    }

    .platform-checkbox {
      width: 18px;
      height: 18px;
      cursor: pointer;
      accent-color: var(--figma-color-bg-brand);
    }

    .platform-info {
      flex: 1;
    }

    .platform-name {
      font-size: 13px;
      font-weight: 600;
      color: var(--figma-color-text);
      margin-bottom: 2px;
    }

    .platform-format {
      font-size: 10px;
      color: var(--figma-color-text-tertiary);
      font-family: 'SF Mono', Monaco, monospace;
    }

    .platform-icon {
      font-size: 24px;
    }

    .file-path-container {
      margin-top: 8px;
      padding-top: 8px;
      border-top: 1px dashed var(--figma-color-border);
    }

    .file-paths-grid {
      display: grid;
      gap: 10px;
    }

    .path-group {
      background: var(--figma-color-bg-secondary);
      padding: 10px;
      border-radius: 6px;
      border: 1px solid var(--figma-color-border);
    }

    .path-group label {
      font-size: 10px;
      margin-bottom: 4px;
    }

    .hint {
      font-size: 10px;
      color: var(--figma-color-text-tertiary);
      margin-top: 4px;
      font-style: italic;
      display: flex;
      align-items: center;
      gap: 4px;
    }

    .hint::before {
      content: "üí°";
      font-size: 11px;
    }

    .radio-group {
      display: flex;
      gap: 16px;
      margin-top: 8px;
    }

    .radio-option {
      display: flex;
      align-items: center;
      gap: 6px;
      cursor: pointer;
    }

    .radio-option input[type="radio"] {
      width: 16px;
      height: 16px;
      cursor: pointer;
      accent-color: var(--figma-color-bg-brand);
    }

    .radio-option label {
      font-size: 11px;
      text-transform: none;
      margin: 0;
      cursor: pointer;
    }

    button {
      width: 100%;
      padding: 12px 16px;
      border: none;
      border-radius: 8px;
      font-size: 13px;
      font-weight: 600;
      cursor: pointer;
      transition: all 0.2s ease;
      margin-bottom: 8px;
      display: flex;
      align-items: center;
      justify-content: center;
      gap: 8px;
    }

    .btn-primary {
      background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
      color: white;
      box-shadow: 0 4px 12px rgba(102, 126, 234, 0.4);
    }

    .btn-primary:hover:not(:disabled) {
      transform: translateY(-2px);
      box-shadow: 0 6px 16px rgba(102, 126, 234, 0.5);
    }

    .btn-primary:active:not(:disabled) {
      transform: translateY(0);
    }

    .btn-primary:disabled {
      opacity: 0.5;
      cursor: not-allowed;
      transform: none;
      box-shadow: none;
    }

    .btn-secondary {
      background: var(--figma-color-bg);
      color: var(--figma-color-text);
      border: 1.5px solid var(--figma-color-border);
    }

    .btn-secondary:hover {
      background: var(--figma-color-bg-tertiary);
      border-color: var(--figma-color-text-tertiary);
    }

    .btn-group {
      display: grid;
      grid-template-columns: 1fr 1fr;
      gap: 8px;
    }

    .status {
      padding: 12px 14px;
      border-radius: 8px;
      margin-top: 16px;
      font-size: 12px;
      display: none;
      animation: slideIn 0.3s ease;
    }

    @keyframes slideIn {
      from {
        opacity: 0;
        transform: translateY(-10px);
      }
      to {
        opacity: 1;
        transform: translateY(0);
      }
    }

    .status.success {
      background: linear-gradient(135deg, #d4edda 0%, #c3e6cb 100%);
      color: #155724;
      border: 1.5px solid #28a745;
    }

    .status.error {
      background: linear-gradient(135deg, #f8d7da 0%, #f5c6cb 100%);
      color: #721c24;
      border: 1.5px solid #dc3545;
    }

    .status.info {
      background: linear-gradient(135deg, #d1ecf1 0%, #bee5eb 100%);
      color: #0c5460;
      border: 1.5px solid #17a2b8;
    }

    .status a {
      color: inherit;
      text-decoration: underline;
      font-weight: 600;
    }

    .divider {
      height: 1px;
      background: linear-gradient(90deg, transparent, var(--figma-color-border), transparent);
      margin: 20px 0;
    }

    .info-box {
      background: linear-gradient(135deg, #667eea15 0%, #764ba215 100%);
      border: 1.5px solid var(--figma-color-bg-brand);
      padding: 14px;
      border-radius: 8px;
      margin-bottom: 14px;
      font-size: 12px;
    }

    .info-box-title {
      font-weight: 600;
      margin-bottom: 8px;
      display: flex;
      align-items: center;
      gap: 6px;
      color: var(--figma-color-text);
    }

    .info-stats {
      display: grid;
      grid-template-columns: repeat(2, 1fr);
      gap: 8px;
      margin-top: 8px;
    }

    .stat-item {
      text-align: center;
      padding: 8px;
      background: var(--figma-color-bg);
      border-radius: 6px;
      border: 1px solid var(--figma-color-border);
    }

    .stat-number {
      font-size: 18px;
      font-weight: 700;
      color: var(--figma-color-bg-brand);
      display: block;
    }

    .stat-label {
      font-size: 9px;
      color: var(--figma-color-text-tertiary);
      text-transform: uppercase;
      letter-spacing: 0.5px;
      font-weight: 600;
      margin-top: 2px;
    }

    .collections-list {
      margin-top: 8px;
      font-size: 11px;
      color: var(--figma-color-text-secondary);
    }

    .collection-item {
      padding: 4px 8px;
      background: var(--figma-color-bg);
      border-radius: 4px;
      margin-bottom: 4px;
      display: flex;
      align-items: center;
      gap: 6px;
    }

    .collection-item::before {
      content: "üì¶";
      font-size: 12px;
    }

    #log-container {
      max-height: 150px;
      overflow-y: auto;
      background: var(--figma-color-bg-secondary);
      border: 1px solid var(--figma-color-border);
      border-radius: 6px;
      padding: 10px;
      font-family: 'SF Mono', Monaco, monospace;
      font-size: 10px;
      margin-top: 12px;
      display: none;
    }

    .log-entry {
      margin-bottom: 4px;
      word-wrap: break-word;
      padding: 2px 0;
    }

    .log-entry.info {
      color: var(--figma-color-text-secondary);
    }

    .log-entry.success {
      color: #28a745;
      font-weight: 600;
    }

    .log-entry.error {
      color: #dc3545;
      font-weight: 600;
    }

    ::-webkit-scrollbar {
      width: 6px;
      height: 6px;
    }

    ::-webkit-scrollbar-track {
      background: var(--figma-color-bg-secondary);
      border-radius: 3px;
    }

    ::-webkit-scrollbar-thumb {
      background: var(--figma-color-border);
      border-radius: 3px;
    }

    ::-webkit-scrollbar-thumb:hover {
      background: var(--figma-color-text-tertiary);
    }

    .footer {
      text-align: center;
      margin-top: 20px;
      padding-top: 16px;
      border-top: 1px solid var(--figma-color-border);
      font-size: 10px;
      color: var(--figma-color-text-tertiary);
    }

    .footer a {
      color: var(--figma-color-bg-brand);
      text-decoration: none;
      font-weight: 600;
    }

    .advanced-toggle {
      text-align: center;
      margin-top: 12px;
      margin-bottom: 8px;
    }

    .toggle-btn {
      background: none;
      border: none;
      color: var(--figma-color-text-tertiary);
      font-size: 11px;
      cursor: pointer;
      padding: 4px 8px;
      text-decoration: underline;
      display: inline-flex;
      align-items: center;
      gap: 4px;
    }

    .toggle-btn:hover {
      color: var(--figma-color-text);
    }

    .advanced-options {
      display: none;
      margin-top: 12px;
      padding-top: 12px;
      border-top: 1px dashed var(--figma-color-border);
    }

    .advanced-options.visible {
      display: block;
    }
  </style>
</head>

<body>
  <div class="header">
    <div class="header-title">üé® Design System Sync</div>
    <div class="header-subtitle">Export design tokens (strings, colors & fonts) to GitHub for multi-platform projects</div>
    <div class="version-badge">v3.0.0</div>
  </div>

  <div class="section">
    <div class="section-header">
      <span class="section-icon">üîó</span>
      <span class="section-title">GitHub Configuration</span>
    </div>

    <div class="input-group">
      <label>GitHub Username</label>
      <input type="text" id="username" placeholder="your-username">
    </div>

    <div class="input-group">
      <label>Repository Name</label>
      <input type="text" id="repo" placeholder="your-repo">
    </div>

    <div class="input-group">
      <label>Base Branch</label>
      <input type="text" id="baseBranch" placeholder="main" value="main">
    </div>

    <div class="input-group">
      <label>Personal Access Token</label>
      <input type="password" id="token" placeholder="ghp_...">
      <div class="hint">Requires repository write permissions</div>
    </div>

    <div class="btn-group">
      <button class="btn-secondary" id="testBtn">
        <span>üîç</span>
        <span>Test</span>
      </button>
      <button class="btn-secondary" id="saveBtn">
        <span>üíæ</span>
        <span>Save</span>
      </button>
    </div>
  </div>

  <div class="section">
    <div class="section-header">
      <span class="section-icon">üì¶</span>
      <span class="section-title">Export Types</span>
      <span class="badge new">v3.0</span>
    </div>

    <div class="export-type-cards">
      <!-- Strings Export -->
      <div class="export-type-card active" id="stringsCard">
        <div class="export-type-icon">üåê</div>
        <div class="export-type-name">Strings</div>
        <div class="export-type-desc">Localization</div>
        <input type="checkbox" id="exportStrings" class="export-type-checkbox" checked>
      </div>

      <!-- Colors Export -->
      <div class="export-type-card active" id="colorsCard">
        <div class="export-type-icon">üé®</div>
        <div class="export-type-name">Colors</div>
        <div class="export-type-desc">Design tokens</div>
        <input type="checkbox" id="exportColors" class="export-type-checkbox" checked>
      </div>

      <!-- Fonts Export -->
      <div class="export-type-card active" id="fontsCard">
        <div class="export-type-icon">‚úçÔ∏è</div>
        <div class="export-type-name">Fonts</div>
        <div class="export-type-desc">Typography</div>
        <input type="checkbox" id="exportFonts" class="export-type-checkbox" checked>
      </div>
    </div>
  </div>

  <div class="section">
    <div class="section-header">
      <span class="section-icon">üì±</span>
      <span class="section-title">Platform Configuration</span>
      <span class="badge">Multi-platform</span>
    </div>

    <div class="checkbox-group">
      <!-- Android Platform -->
      <div class="platform-card active" id="androidCard">
        <div class="platform-header">
          <input type="checkbox" id="platformAndroid" class="platform-checkbox" checked>
          <div class="platform-info">
            <div class="platform-name">Android / KMP</div>
            <div class="platform-format">XML & Compose</div>
          </div>
          <div class="platform-icon">ü§ñ</div>
        </div>
        
        <div class="file-path-container">
          <div class="file-paths-grid">
            <!-- Strings Path -->
            <div class="path-group">
              <label>üåê Strings Path (XML)</label>
              <input type="text" id="androidStringsPath" 
                placeholder="shared/src/commonMain/composeResources/{lang}/strings.xml"
                value="shared/src/commonMain/composeResources/{lang}/strings.xml">
              <div class="hint">Use {lang} for values, values-ar, etc.</div>
            </div>

            <!-- Colors XML Path -->
            <div class="path-group">
              <label>üé® Colors Path (XML)</label>
              <input type="text" id="androidColorsXmlPath" 
                placeholder="shared/src/commonMain/composeResources/values/colors.xml"
                value="shared/src/commonMain/composeResources/values/colors.xml">
            </div>

            <!-- Compose Colors Path (Optional) -->
            <div class="path-group">
              <label>üé® Compose Colors (Kotlin) - Optional</label>
              <input type="text" id="androidComposeColorsPath" 
                placeholder="shared/src/commonMain/kotlin/theme/Color.kt"
                value="">
              <div class="hint">Leave empty to skip Compose generation</div>
            </div>

            <!-- Typography Path (Optional) -->
            <div class="path-group">
              <label>‚úçÔ∏è Typography (Kotlin) - Optional</label>
              <input type="text" id="androidTypographyPath" 
                placeholder="shared/src/commonMain/kotlin/theme/Typography.kt"
                value="">
              <div class="hint">Leave empty to skip Typography generation</div>
            </div>

            <!-- Package Name for Compose -->
            <div class="path-group" id="composePackageGroup" style="display: none;">
              <label>üì¶ Compose Package Name</label>
              <input type="text" id="androidComposePackage" 
                placeholder="com.example.theme"
                value="">
            </div>
          </div>
        </div>
      </div>

      <!-- iOS Platform -->
      <div class="platform-card" id="iosCard">
        <div class="platform-header">
          <input type="checkbox" id="platformIOS" class="platform-checkbox">
          <div class="platform-info">
            <div class="platform-name">iOS / Swift</div>
            <div class="platform-format">Strings & UIKit/SwiftUI</div>
          </div>
          <div class="platform-icon">üçé</div>
        </div>
        
        <div class="file-path-container">
          <div class="file-paths-grid">
            <!-- Strings Path -->
            <div class="path-group">
              <label>üåê Strings Path</label>
              <input type="text" id="iosStringsPath" 
                placeholder="{lang}.lproj/Localizable.strings"
                value="{lang}.lproj/Localizable.strings">
              <div class="hint">Use {lang} for Base, ar, es, etc.</div>
            </div>

            <!-- Colors Path -->
            <div class="path-group">
              <label>üé® Colors Path (Swift)</label>
              <input type="text" id="iosColorsPath" 
                placeholder="Shared/Theme/Colors.swift"
                value="Shared/Theme/Colors.swift">
            </div>

            <!-- Typography Path -->
            <div class="path-group">
              <label>‚úçÔ∏è Typography Path (Swift)</label>
              <input type="text" id="iosTypographyPath" 
                placeholder="Shared/Theme/Typography.swift"
                value="Shared/Theme/Typography.swift">
            </div>

            <!-- Color Style -->
            <div class="path-group">
              <label>üé® Color Style</label>
              <div class="radio-group">
                <div class="radio-option">
                  <input type="radio" id="iosStyleUIKit" name="iosColorStyle" value="uikit" checked>
                  <label for="iosStyleUIKit">UIKit (UIColor/UIFont)</label>
                </div>
                <div class="radio-option">
                  <input type="radio" id="iosStyleSwiftUI" name="iosColorStyle" value="swiftui">
                  <label for="iosStyleSwiftUI">SwiftUI (Color/Font)</label>
                </div>
              </div>
            </div>
          </div>
        </div>
      </div>

      <!-- Flutter Platform -->
      <div class="platform-card" id="flutterCard">
        <div class="platform-header">
          <input type="checkbox" id="platformFlutter" class="platform-checkbox">
          <div class="platform-info">
            <div class="platform-name">Flutter / Dart</div>
            <div class="platform-format">ARB & Theme</div>
          </div>
          <div class="platform-icon">ü¶ã</div>
        </div>
        
        <div class="file-path-container">
          <div class="file-paths-grid">
            <!-- Strings Path (ARB) -->
            <div class="path-group">
              <label>üåê Strings Path (ARB)</label>
              <input type="text" id="flutterStringsPath" 
                placeholder="lib/l10n/app_{lang}.arb"
                value="lib/l10n/app_{lang}.arb">
              <div class="hint">Use {lang} for en, ar, es, etc.</div>
            </div>

            <!-- Colors Path -->
            <div class="path-group">
              <label>üé® Colors Path (Dart)</label>
              <input type="text" id="flutterColorsPath" 
                placeholder="lib/theme/app_colors.dart"
                value="lib/theme/app_colors.dart">
            </div>

            <!-- Typography Path -->
            <div class="path-group">
              <label>‚úçÔ∏è Typography Path (Dart)</label>
              <input type="text" id="flutterTypographyPath" 
                placeholder="lib/theme/app_text_styles.dart"
                value="lib/theme/app_text_styles.dart">
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>

  <div class="section">
    <div class="section-header">
      <span class="section-icon">üöÄ</span>
      <span class="section-title">Export Configuration</span>
    </div>

    <button class="btn-primary" id="loadBtn">
      <span>üì•</span>
      <span>Load Variables from Figma</span>
    </button>

    <div id="statsBox" class="info-box" style="display: none;">
      <div class="info-box-title">
        <span>üìä</span>
        <span>Loaded Data</span>
      </div>
      <div class="info-stats" id="statsGrid">
        <div class="stat-item">
          <span class="stat-number" id="statStrings">0</span>
          <span class="stat-label">Strings</span>
        </div>
        <div class="stat-item">
          <span class="stat-number" id="statLanguages">0</span>
          <span class="stat-label">Languages</span>
        </div>
        <div class="stat-item">
          <span class="stat-number" id="statColors">0</span>
          <span class="stat-label">Colors</span>
        </div>
        <div class="stat-item">
          <span class="stat-number" id="statFonts">0</span>
          <span class="stat-label">Font Styles</span>
        </div>
        <div class="stat-item">
          <span class="stat-number" id="statCollections">0</span>
          <span class="stat-label">Collections</span>
        </div>
      </div>
      <div class="collections-list" id="collectionsList"></div>
    </div>

    <div class="input-group">
      <label>Commit Message</label>
      <input type="text" id="commitMessage" placeholder="chore: Update design tokens from Figma"
        value="chore: Update design tokens from Figma">
    </div>

    <div class="advanced-toggle">
      <button class="toggle-btn" id="advancedToggle">
        <span>‚öôÔ∏è</span>
        <span id="toggleText">Show Advanced Options</span>
      </button>
    </div>

    <div class="advanced-options" id="advancedOptions">
      <div class="input-group">
        <label>Branch Name</label>
        <input type="text" id="branchName" placeholder="design-tokens" value="design-tokens">
        <div class="hint">Custom branch name for the pull request</div>
      </div>

      <div class="input-group">
        <label>Pull Request Title</label>
        <input type="text" id="prTitle" placeholder="üé® Update Design Tokens from Figma"
          value="üé® Update Design Tokens from Figma">
      </div>

      <div class="input-group">
        <label>PR Description Template</label>
        <select id="prTemplate">
          <option value="detailed">Detailed (recommended)</option>
          <option value="simple">Simple</option>
        </select>
        <div class="hint">Choose the format for the pull request description</div>
      </div>
    </div>

    <button class="btn-primary" id="exportBtn" disabled>
      <span>üöÄ</span>
      <span>Export to GitHub</span>
    </button>
  </div>

  <div id="status" class="status"></div>
  <div id="log-container"></div>

  <div class="footer">
    Made with ‚ù§Ô∏è for multi-platform design systems
  </div>

  <script>
    let variablesData = null;
    const DEBUG_MODE = false;

    // Advanced options toggle
    document.getElementById('advancedToggle').onclick = () => {
      const options = document.getElementById('advancedOptions');
      const toggleText = document.getElementById('toggleText');
      
      if (options.classList.contains('visible')) {
        options.classList.remove('visible');
        toggleText.textContent = 'Show Advanced Options';
      } else {
        options.classList.add('visible');
        toggleText.textContent = 'Hide Advanced Options';
      }
    };

    // Export type card interactions
    document.getElementById('stringsCard').onclick = (e) => {
      if (e.target.type !== 'checkbox') {
        const checkbox = document.getElementById('exportStrings');
        checkbox.checked = !checkbox.checked;
        updateExportTypeCards();
      }
    };

    document.getElementById('colorsCard').onclick = (e) => {
      if (e.target.type !== 'checkbox') {
        const checkbox = document.getElementById('exportColors');
        checkbox.checked = !checkbox.checked;
        updateExportTypeCards();
      }
    };

    document.getElementById('fontsCard').onclick = (e) => {
      if (e.target.type !== 'checkbox') {
        const checkbox = document.getElementById('exportFonts');
        checkbox.checked = !checkbox.checked;
        updateExportTypeCards();
      }
    };

    document.getElementById('exportStrings').onchange = updateExportTypeCards;
    document.getElementById('exportColors').onchange = updateExportTypeCards;
    document.getElementById('exportFonts').onchange = updateExportTypeCards;

    function updateExportTypeCards() {
      const stringsCard = document.getElementById('stringsCard');
      const colorsCard = document.getElementById('colorsCard');
      const fontsCard = document.getElementById('fontsCard');
      const stringsChecked = document.getElementById('exportStrings').checked;
      const colorsChecked = document.getElementById('exportColors').checked;
      const fontsChecked = document.getElementById('exportFonts').checked;

      stringsCard.classList.toggle('active', stringsChecked);
      colorsCard.classList.toggle('active', colorsChecked);
      fontsCard.classList.toggle('active', fontsChecked);
    }

    // Platform card interactions
    document.getElementById('androidCard').onclick = (e) => {
      if (e.target.type !== 'checkbox' && e.target.tagName !== 'INPUT' && e.target.type !== 'radio') {
        const checkbox = document.getElementById('platformAndroid');
        checkbox.checked = !checkbox.checked;
        updatePlatformCards();
      }
    };

    document.getElementById('iosCard').onclick = (e) => {
      if (e.target.type !== 'checkbox' && e.target.tagName !== 'INPUT' && e.target.type !== 'radio') {
        const checkbox = document.getElementById('platformIOS');
        checkbox.checked = !checkbox.checked;
        updatePlatformCards();
      }
    };

    document.getElementById('flutterCard').onclick = (e) => {
      if (e.target.type !== 'checkbox' && e.target.tagName !== 'INPUT' && e.target.type !== 'radio') {
        const checkbox = document.getElementById('platformFlutter');
        checkbox.checked = !checkbox.checked;
        updatePlatformCards();
      }
    };

    document.getElementById('platformAndroid').onchange = updatePlatformCards;
    document.getElementById('platformIOS').onchange = updatePlatformCards;
    document.getElementById('platformFlutter').onchange = updatePlatformCards;

    // Show/hide Compose package input based on Compose path or Typography path
    document.getElementById('androidComposeColorsPath').oninput = updateComposePackageVisibility;
    document.getElementById('androidTypographyPath').oninput = updateComposePackageVisibility;

    function updateComposePackageVisibility() {
      const colorsPath = document.getElementById('androidComposeColorsPath').value.trim();
      const typographyPath = document.getElementById('androidTypographyPath').value.trim();
      const packageGroup = document.getElementById('composePackageGroup');
      packageGroup.style.display = (colorsPath || typographyPath) ? 'block' : 'none';
    }

    function updatePlatformCards() {
      const androidCard = document.getElementById('androidCard');
      const iosCard = document.getElementById('iosCard');
      const flutterCard = document.getElementById('flutterCard');
      const androidChecked = document.getElementById('platformAndroid').checked;
      const iosChecked = document.getElementById('platformIOS').checked;
      const flutterChecked = document.getElementById('platformFlutter').checked;

      androidCard.classList.toggle('active', androidChecked);
      iosCard.classList.toggle('active', iosChecked);
      flutterCard.classList.toggle('active', flutterChecked);
    }

    // Load saved settings
    window.onmessage = async (event) => {
      const msg = event.data.pluginMessage;

      if (msg.type === 'load-settings' && msg.settings) {
        const s = msg.settings;
        document.getElementById('username').value = s.username || '';
        document.getElementById('repo').value = s.repo || '';
        document.getElementById('baseBranch').value = s.baseBranch || 'main';
        document.getElementById('token').value = s.token || '';
        
        // Export types
        document.getElementById('exportStrings').checked = s.exportStrings !== false;
        document.getElementById('exportColors').checked = s.exportColors !== false;
        document.getElementById('exportFonts').checked = s.exportFonts !== false;
        
        // Android paths
        document.getElementById('androidStringsPath').value = s.androidStringsPath || 'shared/src/commonMain/composeResources/{lang}/strings.xml';
        document.getElementById('androidColorsXmlPath').value = s.androidColorsXmlPath || 'shared/src/commonMain/composeResources/values/colors.xml';
        document.getElementById('androidComposeColorsPath').value = s.androidComposeColorsPath || '';
        document.getElementById('androidTypographyPath').value = s.androidTypographyPath || '';
        document.getElementById('androidComposePackage').value = s.androidComposePackage || '';
        
        // iOS paths
        document.getElementById('iosStringsPath').value = s.iosStringsPath || '{lang}.lproj/Localizable.strings';
        document.getElementById('iosColorsPath').value = s.iosColorsPath || 'Shared/Theme/Colors.swift';
        document.getElementById('iosTypographyPath').value = s.iosTypographyPath || 'Shared/Theme/Typography.swift';
        
        const iosStyle = s.iosColorStyle || 'uikit';
        document.getElementById('iosStyleUIKit').checked = iosStyle === 'uikit';
        document.getElementById('iosStyleSwiftUI').checked = iosStyle === 'swiftui';
        
        // Flutter paths
        document.getElementById('flutterStringsPath').value = s.flutterStringsPath || 'lib/l10n/app_{lang}.arb';
        document.getElementById('flutterColorsPath').value = s.flutterColorsPath || 'lib/theme/app_colors.dart';
        document.getElementById('flutterTypographyPath').value = s.flutterTypographyPath || 'lib/theme/app_text_styles.dart';
        
        // Platforms
        document.getElementById('platformAndroid').checked = s.platformAndroid !== false;
        document.getElementById('platformIOS').checked = s.platformIOS === true;
        document.getElementById('platformFlutter').checked = s.platformFlutter === true;
        
        // Advanced
        document.getElementById('branchName').value = s.branchName || 'design-tokens';
        document.getElementById('prTitle').value = s.prTitle || 'üé® Update Design Tokens from Figma';
        document.getElementById('prTemplate').value = s.prTemplate || 'detailed';
        
        updateExportTypeCards();
        updatePlatformCards();
        updateComposePackageVisibility();
      }

      if (msg.type === 'log' && DEBUG_MODE) {
        addLog(msg.message, msg.logType);
      }

      if (msg.type === 'variables-data') {
        variablesData = msg.data;
        document.getElementById('exportBtn').disabled = false;
        document.getElementById('statsBox').style.display = 'block';
        
        document.getElementById('statStrings').textContent = msg.stats.strings || 0;
        document.getElementById('statLanguages').textContent = msg.stats.languages || 0;
        document.getElementById('statColors').textContent = msg.stats.colors || 0;
        document.getElementById('statFonts').textContent = msg.stats.fonts || 0;
        document.getElementById('statCollections').textContent = msg.stats.collections || 0;
        
        // Show collection names
        const collectionsList = document.getElementById('collectionsList');
        if (msg.stats.collectionNames && msg.stats.collectionNames.length > 0) {
          collectionsList.innerHTML = msg.stats.collectionNames.map(name => 
            `<div class="collection-item">${name}</div>`
          ).join('');
        }
        
        const parts = [];
        if (msg.stats.strings) parts.push(`${msg.stats.strings} strings`);
        if (msg.stats.colors) parts.push(`${msg.stats.colors} colors`);
        if (msg.stats.fonts) parts.push(`${msg.stats.fonts} fonts`);
        
        showStatus(`‚úÖ Loaded ${parts.join(', ')} successfully!`, 'success');
      }

      if (msg.type === 'test-success') {
        showStatus(`‚úÖ Connected to ${msg.data.fullName}`, 'success');
      }

      if (msg.type === 'test-error') {
        showStatus(`‚ùå ${msg.message}`, 'error');
      }

      if (msg.type === 'upload-success') {
        if (msg.data.prNumber) {
          showStatus(`üéâ Success! Pull Request #${msg.data.prNumber} created! <a href="${msg.data.prUrl}" target="_blank">View PR ‚Üí</a>`, 'success');
        } else {
          showStatus('‚úÖ Files updated successfully!', 'success');
        }
      }

      if (msg.type === 'upload-error') {
        showStatus(`‚ùå ${msg.message}`, 'error');
      }

      if (msg.type === 'error') {
        showStatus(`‚ùå ${msg.message}`, 'error');
      }

      if (msg.type === 'settings-saved') {
        showStatus('üíæ Settings saved successfully!', 'info');
      }
    };

    // Save settings
    document.getElementById('saveBtn').onclick = () => {
      const settings = {
        username: document.getElementById('username').value,
        repo: document.getElementById('repo').value,
        baseBranch: document.getElementById('baseBranch').value,
        token: document.getElementById('token').value,
        
        exportStrings: document.getElementById('exportStrings').checked,
        exportColors: document.getElementById('exportColors').checked,
        exportFonts: document.getElementById('exportFonts').checked,
        
        androidStringsPath: document.getElementById('androidStringsPath').value,
        androidColorsXmlPath: document.getElementById('androidColorsXmlPath').value,
        androidComposeColorsPath: document.getElementById('androidComposeColorsPath').value,
        androidTypographyPath: document.getElementById('androidTypographyPath').value,
        androidComposePackage: document.getElementById('androidComposePackage').value,
        
        iosStringsPath: document.getElementById('iosStringsPath').value,
        iosColorsPath: document.getElementById('iosColorsPath').value,
        iosTypographyPath: document.getElementById('iosTypographyPath').value,
        iosColorStyle: document.querySelector('input[name="iosColorStyle"]:checked').value,
        
        flutterStringsPath: document.getElementById('flutterStringsPath').value,
        flutterColorsPath: document.getElementById('flutterColorsPath').value,
        flutterTypographyPath: document.getElementById('flutterTypographyPath').value,
        
        platformAndroid: document.getElementById('platformAndroid').checked,
        platformIOS: document.getElementById('platformIOS').checked,
        platformFlutter: document.getElementById('platformFlutter').checked,
        
        branchName: document.getElementById('branchName').value,
        prTitle: document.getElementById('prTitle').value,
        prTemplate: document.getElementById('prTemplate').value
      };

      if (DEBUG_MODE) {
        console.log('Saving settings:', { ...settings, token: settings.token ? 'ghp_...' : '' });
      }

      parent.postMessage({ pluginMessage: { type: 'save-settings', settings } }, '*');
    };

    // Test connection
    document.getElementById('testBtn').onclick = () => {
      const settings = {
        username: document.getElementById('username').value,
        repo: document.getElementById('repo').value,
        token: document.getElementById('token').value
      };

      if (!settings.username || !settings.repo || !settings.token) {
        showStatus('‚ö†Ô∏è Please fill in all GitHub settings first', 'error');
        return;
      }

      showStatus('üîÑ Testing connection...', 'info');
      parent.postMessage({ pluginMessage: { type: 'test-github', settings } }, '*');
    };

    // Load variables
    document.getElementById('loadBtn').onclick = () => {
      showStatus('üîÑ Loading variables from Figma...', 'info');
      parent.postMessage({ pluginMessage: { type: 'export-variables' } }, '*');
    };

    // Export to GitHub
    document.getElementById('exportBtn').onclick = () => {
      const username = document.getElementById('username').value;
      const repo = document.getElementById('repo').value;
      const baseBranch = document.getElementById('baseBranch').value;
      const token = document.getElementById('token').value;
      const commitMessage = document.getElementById('commitMessage').value;
      
      const exportStrings = document.getElementById('exportStrings').checked;
      const exportColors = document.getElementById('exportColors').checked;
      const exportFonts = document.getElementById('exportFonts').checked;
      
      const platformAndroid = document.getElementById('platformAndroid').checked;
      const platformIOS = document.getElementById('platformIOS').checked;
      const platformFlutter = document.getElementById('platformFlutter').checked;
      
      const androidStringsPath = document.getElementById('androidStringsPath').value;
      const androidColorsXmlPath = document.getElementById('androidColorsXmlPath').value;
      const androidComposeColorsPath = document.getElementById('androidComposeColorsPath').value;
      const androidTypographyPath = document.getElementById('androidTypographyPath').value;
      const androidComposePackage = document.getElementById('androidComposePackage').value;
      
      const iosStringsPath = document.getElementById('iosStringsPath').value;
      const iosColorsPath = document.getElementById('iosColorsPath').value;
      const iosTypographyPath = document.getElementById('iosTypographyPath').value;
      const iosColorStyle = document.querySelector('input[name="iosColorStyle"]:checked').value;
      
      const flutterStringsPath = document.getElementById('flutterStringsPath').value;
      const flutterColorsPath = document.getElementById('flutterColorsPath').value;
      const flutterTypographyPath = document.getElementById('flutterTypographyPath').value;
      
      const branchName = document.getElementById('branchName').value;
      const prTitle = document.getElementById('prTitle').value;
      const prTemplate = document.getElementById('prTemplate').value;

      // Validations
      if (!username || !repo || !baseBranch || !token) {
        showStatus('‚ö†Ô∏è Please fill in all GitHub settings', 'error');
        return;
      }

      if (!platformAndroid && !platformIOS && !platformFlutter) {
        showStatus('‚ö†Ô∏è Please select at least one platform', 'error');
        return;
      }

      if (!exportStrings && !exportColors && !exportFonts) {
        showStatus('‚ö†Ô∏è Please select at least one export type', 'error');
        return;
      }

      if (!variablesData) {
        showStatus('‚ö†Ô∏è Please load variables first', 'error');
        return;
      }

      // Path validations for strings
      if (exportStrings) {
        if (platformAndroid && !androidStringsPath.includes('{lang}')) {
          showStatus('‚ö†Ô∏è Android strings path must include {lang} placeholder', 'error');
          return;
        }

        if (platformIOS && !iosStringsPath.includes('{lang}')) {
          showStatus('‚ö†Ô∏è iOS strings path must include {lang} placeholder', 'error');
          return;
        }

        if (platformFlutter && !flutterStringsPath.includes('{lang}')) {
          showStatus('‚ö†Ô∏è Flutter strings path must include {lang} placeholder', 'error');
          return;
        }
      }

      // Validation for Compose/Typography package
      if ((androidComposeColorsPath || androidTypographyPath) && !androidComposePackage) {
        showStatus('‚ö†Ô∏è Please provide a package name for Compose/Typography', 'error');
        return;
      }

      if (DEBUG_MODE) {
        console.log('DEBUG UI: Starting export');
      }

      showStatus('üöÄ Starting export...', 'info');

      parent.postMessage({
        pluginMessage: {
          type: 'upload-github',
          data: {
            username,
            repo,
            baseBranch,
            token,
            commitMessage,
            variablesData,
            exportTypes: {
              strings: exportStrings,
              colors: exportColors,
              fonts: exportFonts
            },
            platforms: {
              android: platformAndroid,
              ios: platformIOS,
              flutter: platformFlutter
            },
            filePaths: {
              androidStrings: androidStringsPath,
              androidColorsXml: androidColorsXmlPath,
              androidComposeColors: androidComposeColorsPath,
              androidTypography: androidTypographyPath,
              androidComposePackage: androidComposePackage,
              iosStrings: iosStringsPath,
              iosColors: iosColorsPath,
              iosTypography: iosTypographyPath,
              iosColorStyle: iosColorStyle,
              flutterStrings: flutterStringsPath,
              flutterColors: flutterColorsPath,
              flutterTypography: flutterTypographyPath
            },
            branchName,
            prTitle,
            prTemplate
          }
        }
      }, '*');
    };

    function showStatus(message, type) {
      const status = document.getElementById('status');
      status.className = 'status ' + type;
      status.innerHTML = message;
      status.style.display = 'block';
    }

    function logMessage(message, type = 'info') {
      if (!DEBUG_MODE) return;

      const logContainer = document.getElementById('log-container');
      logContainer.style.display = 'block';

      const timestamp = new Date().toLocaleTimeString();
      const logEntry = document.createElement('div');
      logEntry.className = 'log-entry ' + type;
      logEntry.textContent = '[' + timestamp + '] ' + message;
      logContainer.appendChild(logEntry);
      logContainer.scrollTop = logContainer.scrollHeight;
    }

    function addLog(message, type) {
      logMessage(message, type);
    }

    // Initialize
    updateExportTypeCards();
    updatePlatformCards();
  </script>
</body>
</html>
