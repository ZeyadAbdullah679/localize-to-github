<!DOCTYPE html>
<html>

<head>
  <meta charset="utf-8">
  <style>
    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
    }

    body {
      font-family: 'Inter', -apple-system, BlinkMacSystemFont, 'Segoe UI', sans-serif;
      font-size: 13px;
      line-height: 1.5;
      color: #e4e4e7;
      background: #09090b;
      overflow-x: hidden;
    }

    .container {
      max-width: 600px;
      margin: 0 auto;
      background: #18181b;
    }

    /* Header */
    .header {
      background: linear-gradient(135deg, #4c1d95 0%, #6d28d9 50%, #7c3aed 100%);
      color: white;
      padding: 24px;
      text-align: center;
      border-bottom: 2px solid #a78bfa;
    }

    .header h1 {
      font-size: 22px;
      font-weight: 700;
      margin-bottom: 6px;
    }

    .header p {
      font-size: 13px;
      opacity: 0.95;
    }

    /* Sections */
    .section {
      padding: 20px 24px;
      border-bottom: 1px solid #27272a;
    }

    .section-title {
      font-size: 14px;
      font-weight: 600;
      margin-bottom: 14px;
      color: #f4f4f5;
      display: flex;
      align-items: center;
      gap: 8px;
    }

    .section-title::before {
      content: '';
      width: 4px;
      height: 18px;
      background: linear-gradient(135deg, #7c3aed 0%, #a78bfa 100%);
      border-radius: 2px;
    }

    /* Stats Grid */
    .stats-grid {
      display: grid;
      grid-template-columns: repeat(3, 1fr);
      gap: 12px;
      margin-top: 14px;
    }

    .stat-card {
      background: linear-gradient(135deg, #27272a 0%, #3f3f46 100%);
      padding: 16px;
      border-radius: 10px;
      text-align: center;
      border: 1px solid #3f3f46;
    }

    .stat-value {
      font-size: 28px;
      font-weight: 700;
      background: linear-gradient(135deg, #a78bfa 0%, #c4b5fd 100%);
      -webkit-background-clip: text;
      -webkit-text-fill-color: transparent;
      background-clip: text;
      display: block;
    }

    .stat-label {
      font-size: 11px;
      color: #a1a1aa;
      margin-top: 4px;
      display: block;
      text-transform: uppercase;
      letter-spacing: 0.5px;
    }

    /* Export Types */
    .export-types {
      display: grid;
      grid-template-columns: repeat(3, 1fr);
      gap: 10px;
    }

    .export-type-btn {
      padding: 14px;
      border: 2px solid #3f3f46;
      border-radius: 10px;
      background: #27272a;
      cursor: pointer;
      transition: all 0.2s;
      text-align: center;
      position: relative;
    }

    .export-type-btn:hover {
      border-color: #7c3aed;
      background: #3f3f46;
      transform: translateY(-2px);
      box-shadow: 0 4px 12px rgba(124, 58, 237, 0.3);
    }

    .export-type-btn.active {
      border-color: #7c3aed;
      background: linear-gradient(135deg, #4c1d95 0%, #7c3aed 100%);
      color: white;
      box-shadow: 0 4px 12px rgba(124, 58, 237, 0.5);
    }

    .export-type-btn input[type="checkbox"] {
      position: absolute;
      opacity: 0;
      pointer-events: none;
    }

    .export-type-icon {
      font-size: 24px;
      display: block;
      margin-bottom: 6px;
    }

    .export-type-label {
      font-weight: 600;
      font-size: 12px;
      display: block;
    }

    /* Platform Selection */
    .platform-selection {
      display: grid;
      grid-template-columns: repeat(3, 1fr);
      gap: 12px;
      margin-bottom: 16px;
    }

    .platform-radio {
      position: relative;
    }

    .platform-radio input[type="radio"] {
      position: absolute;
      opacity: 0;
    }

    .platform-radio label {
      display: block;
      padding: 16px;
      border: 2px solid #3f3f46;
      border-radius: 10px;
      background: #27272a;
      cursor: pointer;
      transition: all 0.2s;
      text-align: center;
      font-weight: 600;
      font-size: 13px;
      color: #e4e4e7;
    }

    .platform-radio input:checked+label {
      border-color: #7c3aed;
      background: linear-gradient(135deg, #4c1d95 0%, #7c3aed 100%);
      color: white;
      box-shadow: 0 4px 12px rgba(124, 58, 237, 0.5);
    }

    .platform-radio label:hover {
      border-color: #7c3aed;
      transform: translateY(-2px);
      box-shadow: 0 4px 12px rgba(124, 58, 237, 0.3);
    }

    /* Platform Config */
    .platform-config {
      display: none;
      background: #27272a;
      padding: 18px;
      border-radius: 10px;
      margin-top: 14px;
      border: 1px solid #3f3f46;
    }

    .platform-config.active {
      display: block;
      animation: slideDown 0.3s ease;
    }

    @keyframes slideDown {
      from {
        opacity: 0;
        transform: translateY(-10px);
      }

      to {
        opacity: 1;
        transform: translateY(0);
      }
    }

    .config-section {
      margin-bottom: 16px;
      padding: 14px;
      background: #18181b;
      border-radius: 8px;
      border: 1px solid #3f3f46;
    }

    .config-section:last-child {
      margin-bottom: 0;
    }

    .config-section.hidden {
      display: none;
    }

    .config-group {
      margin-bottom: 12px;
    }

    .config-group:last-child {
      margin-bottom: 0;
    }

    .config-label {
      font-size: 12px;
      font-weight: 600;
      margin-bottom: 6px;
      display: block;
      color: #f4f4f5;
    }

    .config-sublabel {
      font-size: 11px;
      color: #a1a1aa;
      margin-bottom: 8px;
      display: block;
    }

    /* Format Selection */
    .format-selection {
      display: flex;
      gap: 8px;
      margin-top: 8px;
    }

    .format-btn {
      flex: 1;
      padding: 10px 14px;
      border: 2px solid #3f3f46;
      border-radius: 8px;
      background: #27272a;
      cursor: pointer;
      font-size: 12px;
      font-weight: 600;
      text-align: center;
      transition: all 0.2s;
      color: #e4e4e7;
    }

    .format-btn:hover {
      border-color: #7c3aed;
      background: #3f3f46;
    }

    .format-btn.active {
      border-color: #7c3aed;
      background: linear-gradient(135deg, #4c1d95 0%, #7c3aed 100%);
      color: white;
    }

    /* Input Fields */
    input[type="text"],
    input[type="password"],
    textarea {
      width: 100%;
      padding: 11px 14px;
      border: 2px solid #3f3f46;
      border-radius: 8px;
      font-size: 13px;
      font-family: inherit;
      transition: all 0.2s;
      background: #09090b;
      color: #e4e4e7;
    }

    input[type="text"]:focus,
    input[type="password"]:focus,
    textarea:focus {
      outline: none;
      border-color: #7c3aed;
      box-shadow: 0 0 0 3px rgba(124, 58, 237, 0.2);
    }

    input[type="text"]::placeholder,
    input[type="password"]::placeholder,
    textarea::placeholder {
      color: #71717a;
    }

    textarea {
      resize: vertical;
      min-height: 70px;
    }

    /* Buttons */
    .btn {
      padding: 14px 22px;
      border: none;
      border-radius: 8px;
      font-size: 14px;
      font-weight: 600;
      cursor: pointer;
      transition: all 0.2s;
      width: 100%;
    }

    .btn-primary {
      background: linear-gradient(135deg, #4c1d95 0%, #7c3aed 100%);
      color: white;
      box-shadow: 0 4px 12px rgba(124, 58, 237, 0.4);
    }

    .btn-primary:hover:not(:disabled) {
      transform: translateY(-2px);
      box-shadow: 0 6px 16px rgba(124, 58, 237, 0.6);
    }

    .btn-secondary {
      background: #27272a;
      color: #e4e4e7;
      border: 2px solid #3f3f46;
    }

    .btn-secondary:hover {
      background: #3f3f46;
      border-color: #7c3aed;
    }

    .btn:disabled {
      opacity: 0.5;
      cursor: not-allowed;
      transform: none !important;
    }

    .btn-group {
      display: grid;
      grid-template-columns: 1fr 1fr;
      gap: 10px;
      margin-top: 14px;
    }

    /* Messages */
    .message {
      padding: 14px 18px;
      border-radius: 8px;
      margin: 16px 24px;
      font-size: 13px;
      display: none;
      position: sticky;
      top: 0;
      z-index: 100;
      box-shadow: 0 4px 12px rgba(0, 0, 0, 0.3);
      font-weight: 500;
    }

    .message.show {
      display: block;
      animation: slideDown 0.3s ease;
    }

    .message.success {
      background: linear-gradient(135deg, #064e3b 0%, #065f46 100%);
      color: #86efac;
      border: 2px solid #10b981;
    }

    .message.error {
      background: linear-gradient(135deg, #7f1d1d 0%, #991b1b 100%);
      color: #fca5a5;
      border: 2px solid #ef4444;
    }

    .message.info {
      background: linear-gradient(135deg, #1e3a8a 0%, #1e40af 100%);
      color: #93c5fd;
      border: 2px solid #3b82f6;
    }

    /* Loading Spinner */
    .spinner {
      border: 3px solid rgba(255, 255, 255, 0.3);
      border-top: 3px solid white;
      border-radius: 50%;
      width: 18px;
      height: 18px;
      animation: spin 0.8s linear infinite;
      display: inline-block;
      margin-right: 8px;
      vertical-align: middle;
    }

    @keyframes spin {
      0% {
        transform: rotate(0deg);
      }

      100% {
        transform: rotate(360deg);
      }
    }

    /* Collapsible */
    .collapsible-header {
      cursor: pointer;
      user-select: none;
      display: flex;
      justify-content: space-between;
      align-items: center;
      padding: 4px 0;
    }

    .collapsible-header::after {
      content: '‚ñº';
      font-size: 11px;
      transition: transform 0.2s;
      color: #a78bfa;
    }

    .collapsible-header.collapsed::after {
      transform: rotate(-90deg);
    }

    .collapsible-content {
      max-height: 2000px;
      overflow: hidden;
      transition: max-height 0.3s ease;
    }

    .collapsible-content.collapsed {
      max-height: 0;
    }

    /* Input Grid */
    .input-grid {
      display: grid;
      grid-template-columns: 1fr 1fr;
      gap: 14px;
    }

    .input-grid.full {
      grid-template-columns: 1fr;
    }

    /* Section Headers */
    .config-section-title {
      font-size: 12px;
      font-weight: 700;
      color: #a78bfa;
      margin-bottom: 12px;
      text-transform: uppercase;
      letter-spacing: 0.5px;
      display: flex;
      align-items: center;
      gap: 6px;
    }

    /* Scrollbar */
    ::-webkit-scrollbar {
      width: 8px;
    }

    ::-webkit-scrollbar-track {
      background: #18181b;
    }

    ::-webkit-scrollbar-thumb {
      background: linear-gradient(135deg, #4c1d95 0%, #7c3aed 100%);
      border-radius: 4px;
    }

    ::-webkit-scrollbar-thumb:hover {
      background: linear-gradient(135deg, #5b21b6 0%, #8b5cf6 100%);
    }
  </style>
</head>

<body>
  <div class="container">
    <!-- Header -->
    <div class="header">
      <h1>üé® Design System Sync</h1>
      <p>v3.0 - Strings, Colors & Typography</p>
    </div>

    <!-- Message Area -->
    <div id="message" class="message"></div>

    <!-- Step 1: GitHub Settings -->
    <div class="section">
      <div class="section-title collapsible-header" id="githubHeader">
        ‚öôÔ∏è GitHub Settings
      </div>
      <div class="collapsible-content" id="githubContent">
        <div class="input-grid" style="margin-top: 12px;">
          <div class="config-group">
            <label class="config-label">Username</label>
            <input type="text" id="username" placeholder="octocat">
          </div>
          <div class="config-group">
            <label class="config-label">Repository</label>
            <input type="text" id="repo" placeholder="my-app">
          </div>
        </div>
        <div class="input-grid" style="margin-top: 12px;">
          <div class="config-group">
            <label class="config-label">Base Branch</label>
            <input type="text" id="baseBranch" placeholder="development" value="development">
          </div>
          <div class="config-group">
            <label class="config-label">Access Token</label>
            <input type="password" id="token" placeholder="ghp_...">
          </div>
        </div>
        <div class="btn-group">
          <button class="btn btn-secondary" id="testBtn">üîå Test</button>
          <button class="btn btn-primary" id="saveBtn">üíæ Save</button>
        </div>
      </div>
    </div>

    <!-- Step 2: Export Types -->
    <div class="section">
      <div class="section-title">üì¶ What to Export</div>
      <div class="export-types">
        <div class="export-type-btn active" data-type="strings">
          <input type="checkbox" id="exportStrings" checked>
          <span class="export-type-icon">üåê</span>
          <span class="export-type-label">Strings</span>
        </div>
        <div class="export-type-btn active" data-type="colors">
          <input type="checkbox" id="exportColors" checked>
          <span class="export-type-icon">üé®</span>
          <span class="export-type-label">Colors</span>
        </div>
        <div class="export-type-btn active" data-type="fonts">
          <input type="checkbox" id="exportFonts" checked>
          <span class="export-type-icon">‚úçÔ∏è</span>
          <span class="export-type-label">Typography</span>
        </div>
      </div>
    </div>

    <!-- Step 3: Platform Selection (Radio) -->
    <div class="section">
      <div class="section-title">üì± Select Platform</div>
      <div class="platform-selection">
        <div class="platform-radio">
          <input type="radio" name="platform" id="platformAndroid" value="android" checked>
          <label for="platformAndroid">ü§ñ Android/KMP</label>
        </div>
        <div class="platform-radio">
          <input type="radio" name="platform" id="platformIOS" value="ios">
          <label for="platformIOS">üçé iOS</label>
        </div>
        <div class="platform-radio">
          <input type="radio" name="platform" id="platformFlutter" value="flutter">
          <label for="platformFlutter">ü¶ã Flutter</label>
        </div>
      </div>

      <!-- Android Config -->
      <div class="platform-config active" id="androidConfig">
        <div class="config-section" id="androidStringsSection">
          <div class="config-section-title">üåê Strings Configuration</div>
          <div class="config-group">
            <label class="config-label">Strings Path</label>
            <span class="config-sublabel">Use {lang} placeholder for language folders</span>
            <input type="text" id="androidStrings" value="shared/src/commonMain/composeResources/{lang}/strings.xml">
          </div>
        </div>

        <div class="config-section" id="androidColorsSection">
          <div class="config-section-title">üé® Colors Configuration</div>
          <div class="config-group">
            <label class="config-label">Export Format</label>
            <div class="format-selection" id="androidColorFormatBtns">
              <button class="format-btn active" data-format="xml">üìÑ XML Only</button>
              <button class="format-btn" data-format="compose">üé® Compose Only</button>
              <button class="format-btn" data-format="both">üì¶ Both</button>
            </div>
          </div>
          <div class="config-group" id="androidColorsXmlGroup">
            <label class="config-label">Colors XML Path</label>
            <input type="text" id="androidColorsXml" value="shared/src/commonMain/composeResources/values/colors.xml">
          </div>
          <div class="config-group" id="androidComposeColorsGroup" style="display: none;">
            <label class="config-label">Compose Color.kt Path</label>
            <input type="text" id="androidComposeColors" value="shared/src/commonMain/kotlin/theme/Color.kt">
          </div>
          <div class="config-group" id="androidComposePackageGroup" style="display: none;">
            <label class="config-label">Package Name (Optional)</label>
            <input type="text" id="androidComposePackage" value="com.example.theme" placeholder="com.example.theme">
          </div>
        </div>

        <div class="config-section" id="androidTypographySection">
          <div class="config-section-title">‚úçÔ∏è Typography Configuration</div>
          <div class="config-group">
            <label class="config-label">Export Format</label>
            <div class="format-selection" id="androidTypographyFormatBtns">
              <button class="format-btn active" data-format="xml">üìÑ XML</button>
              <button class="format-btn" data-format="compose">üé® Compose</button>
              <button class="format-btn" data-format="both">üì¶ Both</button>
            </div>
          </div>
          <div class="config-group" id="androidTypographyXmlGroup">
            <label class="config-label">Styles XML Path</label>
            <input type="text" id="androidTypographyXml"
              value="shared/src/commonMain/composeResources/values/styles.xml" placeholder="values/styles.xml">
          </div>
          <div class="config-group" id="androidTypographyComposeGroup" style="display: none;">
            <label class="config-label">Typography.kt Path</label>
            <input type="text" id="androidTypography" value="shared/src/commonMain/kotlin/theme/Typography.kt"
              placeholder="Typography.kt">
          </div>
        </div>
      </div>

      <!-- iOS Config -->
      <div class="platform-config" id="iosConfig">
        <div class="config-section" id="iosStringsSection">
          <div class="config-section-title">üåê Strings Configuration</div>
          <div class="config-group">
            <label class="config-label">Strings Path</label>
            <span class="config-sublabel">Use {lang} placeholder for .lproj folders</span>
            <input type="text" id="iosStrings" value="{lang}.lproj/Localizable.strings">
          </div>
        </div>

        <div class="config-section" id="iosColorsSection">
          <div class="config-section-title">üé® Colors Configuration</div>
          <div class="config-group">
            <label class="config-label">Framework Style</label>
            <div class="format-selection" id="iosColorStyleBtns">
              <button class="format-btn active" data-format="swiftui">SwiftUI</button>
              <button class="format-btn" data-format="uikit">UIKit</button>
            </div>
          </div>
          <div class="config-group">
            <label class="config-label">Colors.swift Path</label>
            <input type="text" id="iosColors" value="Shared/Theme/Colors.swift">
          </div>
        </div>

        <div class="config-section" id="iosTypographySection">
          <div class="config-section-title">‚úçÔ∏è Typography Configuration</div>
          <div class="config-group">
            <label class="config-label">Typography.swift Path</label>
            <input type="text" id="iosTypography" value="Shared/Theme/Typography.swift">
          </div>
        </div>
      </div>

      <!-- Flutter Config -->
      <div class="platform-config" id="flutterConfig">
        <div class="config-section" id="flutterStringsSection">
          <div class="config-section-title">üåê Strings Configuration</div>
          <div class="config-group">
            <label class="config-label">ARB Files Path</label>
            <span class="config-sublabel">Use {lang} placeholder for language code</span>
            <input type="text" id="flutterStrings" value="lib/l10n/app_{lang}.arb">
          </div>
        </div>

        <div class="config-section" id="flutterColorsSection">
          <div class="config-section-title">üé® Colors Configuration</div>
          <div class="config-group">
            <label class="config-label">Colors Dart Path</label>
            <input type="text" id="flutterColors" value="lib/theme/app_colors.dart">
          </div>
        </div>

        <div class="config-section" id="flutterTypographySection">
          <div class="config-section-title">‚úçÔ∏è Typography Configuration</div>
          <div class="config-group">
            <label class="config-label">Text Styles Dart Path</label>
            <input type="text" id="flutterTypography" value="lib/theme/app_text_styles.dart">
          </div>
        </div>
      </div>

      <!-- Save Configuration Button -->
      <button class="btn btn-primary" id="saveConfigBtn" style="margin-top: 16px;">
        üíæ Save Configuration
      </button>
    </div>


    <!-- Step 4: Load & Stats -->
    <div class="section">
      <div class="section-title">üìä Variables & Styles</div>
      <button class="btn btn-secondary" id="loadBtn">üîÑ Load from Figma</button>
      <div class="stats-grid" id="statsGrid" style="display: none;">
        <div class="stat-card">
          <span class="stat-value" id="statStrings">0</span>
          <span class="stat-label">Strings</span>
        </div>
        <div class="stat-card">
          <span class="stat-value" id="statColors">0</span>
          <span class="stat-label">Colors</span>
        </div>
        <div class="stat-card">
          <span class="stat-value" id="statFonts">0</span>
          <span class="stat-label">Fonts</span>
        </div>
      </div>
    </div>

    <!-- Step 5: Export -->
    <div class="section">
      <div class="section-title">üöÄ Export to GitHub</div>
      <div class="config-group">
        <label class="config-label">Commit Message</label>
        <textarea id="commitMessage" rows="2">üé® Update design tokens from Figma</textarea>
      </div>
      <button class="btn btn-primary" id="exportBtn" disabled>
        <span id="exportBtnText">üì§ Export to GitHub</span>
      </button>
    </div>
  </div>

  <script>
    const DEBUG_MODE = false;

    function log(message, type = 'info') {
      if (!DEBUG_MODE) return;
      console.log(`[${type}]`, message);
    }

    let loadedData = null;
    let settings = {};

    const message = document.getElementById('message');
    const statsGrid = document.getElementById('statsGrid');
    const exportBtn = document.getElementById('exportBtn');

    function updateVisibleSections() {
      const exportStrings = document.getElementById('exportStrings').checked;
      const exportColors = document.getElementById('exportColors').checked;
      const exportFonts = document.getElementById('exportFonts').checked;

      document.getElementById('androidStringsSection').classList.toggle('hidden', !exportStrings);
      document.getElementById('androidColorsSection').classList.toggle('hidden', !exportColors);
      document.getElementById('androidTypographySection').classList.toggle('hidden', !exportFonts);

      document.getElementById('iosStringsSection').classList.toggle('hidden', !exportStrings);
      document.getElementById('iosColorsSection').classList.toggle('hidden', !exportColors);
      document.getElementById('iosTypographySection').classList.toggle('hidden', !exportFonts);

      document.getElementById('flutterStringsSection').classList.toggle('hidden', !exportStrings);
      document.getElementById('flutterColorsSection').classList.toggle('hidden', !exportColors);
      document.getElementById('flutterTypographySection').classList.toggle('hidden', !exportFonts);
    }

    const platformRadios = document.querySelectorAll('input[name="platform"]');
    const androidConfig = document.getElementById('androidConfig');
    const iosConfig = document.getElementById('iosConfig');
    const flutterConfig = document.getElementById('flutterConfig');

    platformRadios.forEach(radio => {
      radio.addEventListener('change', () => {
        androidConfig.classList.remove('active');
        iosConfig.classList.remove('active');
        flutterConfig.classList.remove('active');

        if (radio.value === 'android') androidConfig.classList.add('active');
        else if (radio.value === 'ios') iosConfig.classList.add('active');
        else if (radio.value === 'flutter') flutterConfig.classList.add('active');
      });
    });

    const exportTypeBtns = document.querySelectorAll('.export-type-btn');
    exportTypeBtns.forEach(btn => {
      btn.addEventListener('click', () => {
        const checkbox = btn.querySelector('input[type="checkbox"]');
        checkbox.checked = !checkbox.checked;
        btn.classList.toggle('active', checkbox.checked);
        updateVisibleSections();
      });
    });

    const colorFormatBtns = document.querySelectorAll('#androidColorFormatBtns .format-btn');
    const colorsXmlGroup = document.getElementById('androidColorsXmlGroup');
    const composeColorsGroup = document.getElementById('androidComposeColorsGroup');
    const composePackageGroup = document.getElementById('androidComposePackageGroup');

    colorFormatBtns.forEach(btn => {
      btn.addEventListener('click', () => {
        colorFormatBtns.forEach(b => b.classList.remove('active'));
        btn.classList.add('active');

        const format = btn.dataset.format;
        if (format === 'xml') {
          colorsXmlGroup.style.display = 'block';
          composeColorsGroup.style.display = 'none';
          composePackageGroup.style.display = 'none';
        } else if (format === 'compose') {
          colorsXmlGroup.style.display = 'none';
          composeColorsGroup.style.display = 'block';
          composePackageGroup.style.display = 'block';
        } else if (format === 'both') {
          colorsXmlGroup.style.display = 'block';
          composeColorsGroup.style.display = 'block';
          composePackageGroup.style.display = 'block';
        }
      });
    });

    const typographyFormatBtns = document.querySelectorAll('#androidTypographyFormatBtns .format-btn');
    const typographyXmlGroup = document.getElementById('androidTypographyXmlGroup');
    const typographyComposeGroup = document.getElementById('androidTypographyComposeGroup');

    typographyFormatBtns.forEach(btn => {
      btn.addEventListener('click', () => {
        typographyFormatBtns.forEach(b => b.classList.remove('active'));
        btn.classList.add('active');

        const format = btn.dataset.format;
        if (format === 'xml') {
          typographyXmlGroup.style.display = 'block';
          typographyComposeGroup.style.display = 'none';
        } else if (format === 'compose') {
          typographyXmlGroup.style.display = 'none';
          typographyComposeGroup.style.display = 'block';
        } else if (format === 'both') {
          typographyXmlGroup.style.display = 'block';
          typographyComposeGroup.style.display = 'block';
        }
      });
    });

    const iosColorStyleBtns = document.querySelectorAll('#iosColorStyleBtns .format-btn');
    iosColorStyleBtns.forEach(btn => {
      btn.addEventListener('click', () => {
        iosColorStyleBtns.forEach(b => b.classList.remove('active'));
        btn.classList.add('active');
      });
    });

    function showMessage(text, type = 'info') {
      message.textContent = text;
      message.className = `message ${type} show`;
      setTimeout(() => message.classList.remove('show'), 5000);
    }

    const githubHeader = document.getElementById('githubHeader');
    const githubContent = document.getElementById('githubContent');

    githubHeader.addEventListener('click', () => {
      githubHeader.classList.toggle('collapsed');
      githubContent.classList.toggle('collapsed');
    });

    document.getElementById('testBtn').addEventListener('click', () => {
      const username = document.getElementById('username').value.trim();
      const repo = document.getElementById('repo').value.trim();
      const token = document.getElementById('token').value.trim();

      if (!username || !repo || !token) {
        showMessage('Please fill in all GitHub settings', 'error');
        return;
      }

      showMessage('Testing connection...', 'info');
      parent.postMessage({ pluginMessage: { type: 'test-github', settings: { username, repo, token } } }, '*');
    });

    document.getElementById('saveBtn').addEventListener('click', () => {
      const username = document.getElementById('username').value.trim();
      const repo = document.getElementById('repo').value.trim();
      const baseBranch = document.getElementById('baseBranch').value.trim();
      const token = document.getElementById('token').value.trim();

      if (!username || !repo || !baseBranch || !token) {
        showMessage('Please fill in all required fields', 'error');
        return;
      }

      settings = { username, repo, baseBranch, token };
      parent.postMessage({ pluginMessage: { type: 'save-settings', settings: settings } }, '*');
      showMessage('Settings saved!', 'success');
    });

    document.getElementById('loadBtn').addEventListener('click', () => {
      showMessage('Loading variables from Figma...', 'info');
      parent.postMessage({ pluginMessage: { type: 'export-variables' } }, '*');
    });

    document.getElementById('exportBtn').addEventListener('click', () => {
      if (!loadedData) {
        showMessage('Please load variables first', 'error');
        return;
      }

      const exportTypes = {
        strings: document.getElementById('exportStrings').checked,
        colors: document.getElementById('exportColors').checked,
        fonts: document.getElementById('exportFonts').checked
      };

      if (!exportTypes.strings && !exportTypes.colors && !exportTypes.fonts) {
        showMessage('Please select at least one export type', 'error');
        return;
      }

      const selectedPlatform = document.querySelector('input[name="platform"]:checked').value;
      const platforms = {
        android: selectedPlatform === 'android',
        ios: selectedPlatform === 'ios',
        flutter: selectedPlatform === 'flutter'
      };

      const androidColorFormat = document.querySelector('#androidColorFormatBtns .format-btn.active').dataset.format;
      const androidTypographyFormat = document.querySelector('#androidTypographyFormatBtns .format-btn.active').dataset.format;
      const iosColorStyle = document.querySelector('#iosColorStyleBtns .format-btn.active').dataset.format;

      const filePaths = {
        androidStrings: document.getElementById('androidStrings').value,
        androidColorsXml: document.getElementById('androidColorsXml').value,
        androidComposeColors: document.getElementById('androidComposeColors').value,
        androidComposePackage: document.getElementById('androidComposePackage').value,
        androidTypographyXml: document.getElementById('androidTypographyXml').value,
        androidTypography: document.getElementById('androidTypography').value,
        androidColorFormat: androidColorFormat,
        androidTypographyFormat: androidTypographyFormat,

        iosStrings: document.getElementById('iosStrings').value,
        iosColors: document.getElementById('iosColors').value,
        iosTypography: document.getElementById('iosTypography').value,
        iosColorStyle: iosColorStyle,

        flutterStrings: document.getElementById('flutterStrings').value,
        flutterColors: document.getElementById('flutterColors').value,
        flutterTypography: document.getElementById('flutterTypography').value
      };

      const commitMessage = document.getElementById('commitMessage').value.trim();

      showMessage('Creating pull request...', 'info');
      exportBtn.disabled = true;
      document.getElementById('exportBtnText').innerHTML = '<span class="spinner"></span> Exporting...';

      parent.postMessage({
        pluginMessage: {
          type: 'upload-github',
          data: {
            ...settings,
            commitMessage: commitMessage || 'üé® Update design tokens from Figma',
            variablesData: loadedData,
            exportTypes: exportTypes,
            platforms: platforms,
            filePaths: filePaths,
            branchName: 'design-tokens',
            prTitle: 'üé® Update Design Tokens from Figma',
            prTemplate: 'detailed'
          }
        }
      }, '*');
    });

    window.onmessage = (event) => {
      const msg = event.data.pluginMessage;
      if (!msg) return;

      log('Received message:', msg.type);

      if (msg.type === 'load-settings') {
        if (msg.settings) {
          document.getElementById('username').value = msg.settings.username || '';
          document.getElementById('repo').value = msg.settings.repo || '';
          document.getElementById('baseBranch').value = msg.settings.baseBranch || 'main';
          document.getElementById('token').value = msg.settings.token || '';
          settings = msg.settings;
        }
      }

      // Load saved configuration
      if (msg.type === 'load-config') {
        if (msg.config) {
          const config = msg.config;

          // Set platform
          if (config.selectedPlatform) {
            document.getElementById('platform' + config.selectedPlatform.charAt(0).toUpperCase() + config.selectedPlatform.slice(1)).checked = true;
            // Trigger change event
            document.querySelector('input[name="platform"]:checked').dispatchEvent(new Event('change'));
          }

          // Set export types
          if (config.exportTypes) {
            document.getElementById('exportStrings').checked = config.exportTypes.strings !== false;
            document.getElementById('exportColors').checked = config.exportTypes.colors !== false;
            document.getElementById('exportFonts').checked = config.exportTypes.fonts !== false;

            // Update UI
            exportTypeBtns.forEach(btn => {
              const checkbox = btn.querySelector('input[type="checkbox"]');
              btn.classList.toggle('active', checkbox.checked);
            });
            updateVisibleSections();
          }

          // Android paths
          if (config.androidStrings) document.getElementById('androidStrings').value = config.androidStrings;
          if (config.androidColorsXml) document.getElementById('androidColorsXml').value = config.androidColorsXml;
          if (config.androidComposeColors) document.getElementById('androidComposeColors').value = config.androidComposeColors;
          if (config.androidComposePackage) document.getElementById('androidComposePackage').value = config.androidComposePackage;
          if (config.androidTypographyXml) document.getElementById('androidTypographyXml').value = config.androidTypographyXml;
          if (config.androidTypography) document.getElementById('androidTypography').value = config.androidTypography;

          // Android formats
          if (config.androidColorFormat) {
            colorFormatBtns.forEach(btn => {
              if (btn.dataset.format === config.androidColorFormat) {
                btn.click();
              }
            });
          }
          if (config.androidTypographyFormat) {
            typographyFormatBtns.forEach(btn => {
              if (btn.dataset.format === config.androidTypographyFormat) {
                btn.click();
              }
            });
          }

          // iOS paths
          if (config.iosStrings) document.getElementById('iosStrings').value = config.iosStrings;
          if (config.iosColors) document.getElementById('iosColors').value = config.iosColors;
          if (config.iosTypography) document.getElementById('iosTypography').value = config.iosTypography;

          // iOS format
          if (config.iosColorStyle) {
            iosColorStyleBtns.forEach(btn => {
              if (btn.dataset.format === config.iosColorStyle) {
                btn.click();
              }
            });
          }

          // Flutter paths
          if (config.flutterStrings) document.getElementById('flutterStrings').value = config.flutterStrings;
          if (config.flutterColors) document.getElementById('flutterColors').value = config.flutterColors;
          if (config.flutterTypography) document.getElementById('flutterTypography').value = config.flutterTypography;

          log('Configuration loaded successfully');
        }
      }

      if (msg.type === 'test-success') showMessage(`‚úÖ Connected to ${msg.data.fullName}`, 'success');
      if (msg.type === 'test-error') showMessage(`‚ùå ${msg.message}`, 'error');

      if (msg.type === 'variables-data') {
        loadedData = msg.data;
        document.getElementById('statStrings').textContent = msg.stats.strings || 0;
        document.getElementById('statColors').textContent = msg.stats.colors || 0;
        document.getElementById('statFonts').textContent = msg.stats.fonts || 0;
        statsGrid.style.display = 'grid';
        exportBtn.disabled = false;
        showMessage(`‚úÖ Loaded ${msg.stats.strings} strings, ${msg.stats.colors} colors, ${msg.stats.fonts} fonts`, 'success');
      }

      if (msg.type === 'upload-success') {
        const prUrl = msg.prUrl || 'Successfully created';
        showMessage(`‚úÖ PR created: ${prUrl}`, 'success');
        exportBtn.disabled = false;
        document.getElementById('exportBtnText').textContent = 'üì§ Export to GitHub';
      }


      if (msg.type === 'error') {
        showMessage(`‚ùå ${msg.message}`, 'error');
        exportBtn.disabled = false;
        document.getElementById('exportBtnText').textContent = 'üì§ Export to GitHub';
      }
    };

    // Save Configuration (Platform, Paths, Formats)
    document.getElementById('saveConfigBtn').addEventListener('click', () => {
      const selectedPlatform = document.querySelector('input[name="platform"]:checked').value;

      const exportTypes = {
        strings: document.getElementById('exportStrings').checked,
        colors: document.getElementById('exportColors').checked,
        fonts: document.getElementById('exportFonts').checked
      };

      const androidColorFormat = document.querySelector('#androidColorFormatBtns .format-btn.active')?.dataset.format || 'xml';
      const androidTypographyFormat = document.querySelector('#androidTypographyFormatBtns .format-btn.active')?.dataset.format || 'xml';
      const iosColorStyle = document.querySelector('#iosColorStyleBtns .format-btn.active')?.dataset.format || 'swiftui';

      const config = {
        selectedPlatform: selectedPlatform,
        exportTypes: exportTypes,

        // Android paths and formats
        androidStrings: document.getElementById('androidStrings').value,
        androidColorsXml: document.getElementById('androidColorsXml').value,
        androidComposeColors: document.getElementById('androidComposeColors').value,
        androidComposePackage: document.getElementById('androidComposePackage').value,
        androidTypographyXml: document.getElementById('androidTypographyXml').value,
        androidTypography: document.getElementById('androidTypography').value,
        androidColorFormat: androidColorFormat,
        androidTypographyFormat: androidTypographyFormat,

        // iOS paths and formats
        iosStrings: document.getElementById('iosStrings').value,
        iosColors: document.getElementById('iosColors').value,
        iosTypography: document.getElementById('iosTypography').value,
        iosColorStyle: iosColorStyle,

        // Flutter paths
        flutterStrings: document.getElementById('flutterStrings').value,
        flutterColors: document.getElementById('flutterColors').value,
        flutterTypography: document.getElementById('flutterTypography').value
      };

      parent.postMessage({
        pluginMessage: {
          type: 'save-config',
          config: config
        }
      }, '*');

      showMessage('‚úÖ Configuration saved successfully!', 'success');
    });

    // Load configuration on startup
    window.addEventListener('DOMContentLoaded', () => {
      parent.postMessage({
        pluginMessage: { type: 'load-config' }
      }, '*');
    });


    updateVisibleSections();
  </script>
</body>

</html>